var Kopa_Page_Builder,kpb_current_sidebar,kpb_current_widget,kpb_media,kpb_media_button_reset,kpb_media_button_upload;jQuery(document).ready(function(){Kopa_Page_Builder.load_lightbox_html()}),jQuery(window).load(function(){}),kpb_current_widget={},kpb_current_sidebar={},kpb_media=!1,kpb_media_button_upload={},kpb_media_button_reset={},Kopa_Page_Builder={init_effect:function(){Kopa_Page_Builder.init_sortable(),Kopa_Page_Builder.init_section_tab(),Kopa_Page_Builder.sticky_header(),Kopa_Page_Builder.open_media_center(),jQuery(".kpb-ui-color").wpColorPicker()},load_lightbox_html:function(){jQuery.ajax({beforeSend:function(){},success:function(e){jQuery("body").append(e),jQuery("#kpb-metabox-loading-text").remove(),jQuery("#kpb-wrapper").show(),Kopa_Page_Builder.init_effect()},url:KPB.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_lightbox_html",security:jQuery("#kpb_load_lightbox_html_security").val(),post_id:jQuery("#post_ID").val()}})},main_form_submit:function(){jQuery("form#post").length>0&&jQuery("form#post").on("submit",function(){return jQuery("#kpb-button-save-layouts").click()})},sticky_header:function(){"1"===KPB.is_sticky_toolbar&&jQuery("#kpb-wrapper-header").waypoint("sticky",{direction:"down",stuckClass:"kpb-stuck",wrapper:'<div class="kpb-wrapper-header-sticky" />'})},open_customize_layout:function(e){var t;e.preventDefault(),t="#kpb-layout-customize-lightbox-"+jQuery("#kpb-select-layout option:selected").val(),jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(t).show()},close:function(){jQuery(t).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:t,type:"inline"}})},save_layout_customize:function(e,t,a){e.preventDefault(),Kopa_Page_Builder.show_overlay_loading(),t.ajaxSubmit({beforeSubmit:function(){},success:function(){Kopa_Page_Builder.hide_overlay_loading()},data:{post_id:a}})},close_layout_customize:function(e){e.preventDefault(),Kopa_Page_Builder.close_widget(e)},open_customize:function(e,t,a,i){var n;e.preventDefault(),n="#kpb-customize-lightbox-"+a+"-"+i,jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(n).show()},close:function(){jQuery(n).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:n,type:"inline"}})},save_customize:function(e,t,a){e.preventDefault(),Kopa_Page_Builder.show_overlay_loading(),t.ajaxSubmit({beforeSubmit:function(){},success:function(){Kopa_Page_Builder.hide_overlay_loading()},data:{post_id:a}})},close_customize:function(e){e.preventDefault(),Kopa_Page_Builder.close_widget(e)},open_list_widgets:function(e,t){var a;e.preventDefault(),kpb_current_sidebar=t.parents(".kpb-area"),a="#kpb-widgets-lightbox",jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(a).show()},close:function(){jQuery(a).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:a,type:"inline"}})},close_list_widgets:function(e){e.preventDefault(),jQuery.magnificPopup.close()},add_widget:function(e,t,a,i){var n;e.preventDefault(),Kopa_Page_Builder.close_list_widgets(e),n="#kpb-widget-lightbox",jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(n).show(),jQuery("#kpb-widget-title").text(i),jQuery("#kpb-widget input[name=kpb-widget-class-name]").val(a),jQuery("#kpb-widget input[name=kpb-widget-name]").val(i),jQuery("#kpb-widget input[name=kpb-widget-action]").val("add"),jQuery("#kpb-widget input[name=kpb-widget-id]").val(Kopa_Page_Builder.get_random_id("widget-")),jQuery.ajax({success:function(e){jQuery("#kpb-widget .kpb-form-inner").html(e),Kopa_Page_Builder.open_media_center(),jQuery(".kpb-ui-color").wpColorPicker()},url:KPB.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_get_widget_form",security:jQuery("#kpb_get_widget_form_security").val(),class_name:a}})},close:function(){jQuery(n).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:n,type:"inline"}})},edit_widget:function(e,t,a){var i;e.preventDefault(),kpb_current_widget=t.parents(".kpb-widget"),i="#kpb-widget-lightbox",jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(i).show(),jQuery("#kpb-widget-title").text(kpb_current_widget.find("label").text()),jQuery("#kpb-widget input[name=kpb-widget-class-name]").val(kpb_current_widget.attr("data-class")),jQuery("#kpb-widget input[name=kpb-widget-name]").val(kpb_current_widget.attr("data-name")),jQuery("#kpb-widget input[name=kpb-widget-action]").val("edit"),jQuery("#kpb-widget input[name=kpb-widget-id]").val(a),jQuery.ajax({success:function(e){jQuery("#kpb-widget .kpb-form-inner").html(e),Kopa_Page_Builder.open_media_center(),jQuery(".kpb-ui-color").wpColorPicker()},url:KPB.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_get_widget_form",security:jQuery("#kpb_get_widget_form_security").val(),widget_id:a,class_name:kpb_current_widget.attr("data-class"),post_id:jQuery("#post_ID").val()}})},close:function(){jQuery(i).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:i,type:"inline"},fixedBgPos:!0})},delete_widget:function(e,t,a){var i;e.preventDefault(),i=confirm(KPB.i18n.are_you_sure_to_remove_this_widget),i&&jQuery.ajax({beforeSend:function(){},success:function(){t.parents(".kpb-widget").remove(),jQuery("#kpb-button-save-layouts").click()},url:KPB.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_delete_widget",security:jQuery("#kpb_delete_widget_security").val(),widget_id:a}})},save_widget:function(e,t){e.preventDefault(),Kopa_Page_Builder.show_overlay_loading(),t.ajaxSubmit({beforeSubmit:function(){},success:function(t){var a;t&&(a="#kpb-widget-lightbox",jQuery(a).hide(),jQuery.magnificPopup.close(),"add"===jQuery("#kpb-widget input[name=kpb-widget-action]").val()?kpb_current_sidebar.find(".kpb-area-placeholder").append(t):kpb_current_widget&&kpb_current_widget.find("label").text(t),jQuery("#kpb-widget-title").text(""),jQuery("#kpb-widget input[name=kpb-widget-class-name]").val(""),jQuery("#kpb-widget input[name=kpb-widget-action]").val("add"),jQuery("#kpb-widget input[name=kpb-widget-id]").val(""),jQuery("#kpb-widget input[name=kpb-widget-name]").val("")),Kopa_Page_Builder.close_widget(e),jQuery("#kpb-button-save-layouts").click()}})},close_widget:function(e){e.preventDefault(),jQuery.magnificPopup.close(),jQuery("#kpb-widget .kpb-form-inner").html('<center class="kpb-loading">'+KPB.i18n.loading+"</center>"),Kopa_Page_Builder.hide_overlay_loading()},save_layout:function(e,t){var a,i,n;e.preventDefault(),a=jQuery("#kpb-select-layout").find("option:selected").val(),Kopa_Page_Builder.show_overlay_loading(),i={current_layout:jQuery("#kpb-select-layout").find("option:selected").val(),layouts:[]},n=jQuery(".kpb-layout"),n.length>0&&n.each(function(e,t){var n,r;a=jQuery(t),n={name:a.attr("data-layout"),sections:[]},r=a.find(".kpb-section"),r.length>0&&r.each(function(e,t){var a,i,r;i=jQuery(t),r={name:i.attr("data-section"),areas:[]},a=i.find(".kpb-area"),a.length>0&&a.each(function(e,t){var a,i,n;i=jQuery(t),a={name:i.attr("data-area"),widgets:[]},n=i.find(".kpb-widget"),n.length>0&&n.each(function(e,t){var i,n;i=jQuery(t),n={id:i.attr("id"),name:i.attr("data-name"),class_name:i.attr("data-class")},a.widgets.push(n)}),r.areas.push(a)}),n.sections.push(r)}),i.layouts.push(n)}),jQuery.ajax({error:function(e,t){console.log(t)},beforeSend:function(){t.text(KPB.i18n.saving)},success:function(){t.text(KPB.i18n.save),Kopa_Page_Builder.hide_overlay_loading()},url:KPB.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_save_grid",security:jQuery("#kpb_save_grid_security").val(),data:i,post_id:jQuery("#post_ID").val()}})},show_overlay_loading:function(){jQuery("#kpb-loading-overlay").stop().animate({display:"block",right:"0px"},500)},hide_overlay_loading:function(){jQuery("#kpb-loading-overlay").animate({display:"none",right:"-150px"},500)},hide_preview:function(e,t){e.preventDefault(),"0"===t.attr("data-status")?(jQuery(".kpb-layout > .kpb-col-left").removeClass("kpb-col-12").addClass("kpb-col-8"),jQuery(".kpb-layout > .kpb-col-right").show(),t.attr("data-status","1"),t.text(KPB.i18n.hide_preview)):(jQuery(".kpb-layout > .kpb-col-left").removeClass("kpb-col-8").addClass("kpb-col-12"),jQuery(".kpb-layout > .kpb-col-right").hide(),t.attr("data-status","0"),t.text(KPB.i18n.show_preview))},get_random_id:function(e){return e+Math.random().toString(36).substr(2)},change_layout:function(e,t){var a,i;e.preventDefault(),a=t.find("option:selected").val(),i="#kpb-layout-"+a,jQuery(i).hasClass("kpb-active")||(jQuery(".kpb-layout.kpb-active").removeClass("kpb-active").addClass("kpb-hidden"),jQuery(i).removeClass("kpb-hidden").addClass("kpb-active"))},init_sortable:function(){jQuery(".kpb-area-placeholder").sortable({forcePlaceholderSize:!0,connectWith:".kpb-area-placeholder",placeholder:"kpb-widget-sortable-placeholder",start:function(e,t){return t.placeholder.height(t.helper.outerHeight()-2)}}).disableSelection()},open_media_center:function(){jQuery(".kpb-ui-image-outer").on("click",".kpb-ui-image-button-upload",function(e){return e.preventDefault(),kpb_media_button_upload=jQuery(this),kpb_media?void kpb_media.open():(kpb_media=wp.media.frames.kpb_media=wp.media({title:KPB.i18n.media_center,button:{text:KPB.i18n.choose_image},library:{type:"image"},multiple:!1}),kpb_media.on("select",function(){var e;e=kpb_media.state().get("selection").first().toJSON(),kpb_media_button_upload.parents(".kpb-ui-image-outer").find(".kpb-ui-image").val(e.url),kpb_media_button_upload.parents(".kpb-ui-image-outer").find(".kpb-ui-image-preview").attr("src",e.url)}),void kpb_media.open())}),jQuery(".kpb-ui-image-outer").on("click",".kpb-ui-image-button-reset",function(e){e.preventDefault(),kpb_media_button_reset=jQuery(this),kpb_media_button_reset.attr("data-reset")?(kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image").val(kpb_media_button_reset.attr("data-reset")),kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image-preview").attr("src",kpb_media_button_reset.attr("data-reset"))):(kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image").val(kpb_media_button_reset.attr("")),kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image-preview").attr("src",kpb_media_button_reset.attr("data-preview")))})},init_section_tab:function(){var e;e=jQuery(".kpb-tab-title > a"),e.length>0&&e.each(function(){var e;e=jQuery(this),e.click(function(t){var a,i;t.preventDefault(),i=e.parents(".kpb-wrapper-configuration-toggle"),a=e.parent(),a.hasClass("kpb-tab-title-active")||(i.find(".kpb-tab-title-active").removeClass("kpb-tab-title-active"),i.find(".kpb-tab-content").slideUp(500),a.addClass("kpb-tab-title-active"),jQuery(e.attr("href")).slideDown(500))})})},change_customize_tab:function(e,t){var a,i;e.preventDefault(),i=t.parents(".kpb-wrapper-configuration-toggle"),a=t.parent(),a.hasClass("kpb-tab-title-active")||(i.find(".kpb-tab-title-active").removeClass("kpb-tab-title-active"),i.find(".kpb-tab-content").slideUp(500),a.addClass("kpb-tab-title-active"),jQuery(t.attr("href")).slideDown(500))}};